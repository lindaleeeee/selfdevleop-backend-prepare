---
alwaysApply: true
---

# Common Error Patterns: Backend Development

## [1] CORS (Cross-Origin Resource Sharing) Configuration
--------------------------------------------------
**Problem:** Mobile app or frontend calling backend API gets CORS errors.

**Solution:** Configure CORS in Spring Boot:
```java
@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                    .allowedOrigins("http://localhost:3000", "http://localhost:5173")
                    .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                    .allowedHeaders("*")
                    .allowCredentials(true);
            }
        };
    }
}
```

**TIP:** For production, use environment-specific allowed origins.

## [2] Database Connection Issues
--------------------------------------------------
**Problem:** `Communications link failure` or `Connection refused` errors.

**Common Causes:**
- MySQL server not running
- Wrong connection URL/credentials
- Firewall blocking port 3306
- Database not created

**Solution:**
- Verify MySQL is running: `mysql -u root -p`
- Check `application.properties` connection settings
- Ensure database exists: `CREATE DATABASE habit_launcher_dev;`
- Test connection manually before running app

## [3] JPA/Hibernate Entity Mapping Errors
--------------------------------------------------
**Problem:** `Unknown entity`, `Table doesn't exist`, or `Column not found` errors.

**Solution:**
- Ensure entities are in the same package as `@SpringBootApplication`
- Use `@Entity` annotation on entity classes
- Check `@Table` and `@Column` annotations match database schema
- Verify `spring.jpa.hibernate.ddl-auto` setting (use `update` for dev, `validate` for prod)

## [4] Transaction Management Issues
--------------------------------------------------
**Problem:** Data not persisted, `TransactionRequiredException`, or partial updates.

**Solution:**
- Use `@Transactional` on service methods that modify data
- Ensure service methods are public (Spring AOP requirement)
- Check exception handling - `@Transactional` rolls back on RuntimeException
- Use `@Transactional(readOnly = true)` for read-only operations

## [5] NullPointerException in Service Layer
--------------------------------------------------
**Problem:** NPE when accessing entity relationships or optional fields.

**Solution:**
- Always check for null before accessing: `if (entity != null) { ... }`
- Use Optional properly: `entity.getOptionalField().orElse(defaultValue)`
- Use `@NotNull` validation annotations on DTOs
- Implement proper error handling with custom exceptions

## [6] Validation Errors Not Returned Properly
--------------------------------------------------
**Problem:** Validation errors return 500 instead of 400 with error details.

**Solution:**
- Use `@Valid` or `@Validated` on controller method parameters
- Implement `@ControllerAdvice` with `@ExceptionHandler` for `MethodArgumentNotValidException`
- Return structured error response DTO with field-level errors

## [7] Circular Dependency Issues
--------------------------------------------------
**Problem:** `BeanCurrentlyInCreationException` or circular dependency warnings.

**Solution:**
- Avoid circular dependencies between services
- Use `@Lazy` annotation if circular dependency is unavoidable
- Refactor to extract common logic into separate service
- Consider using events or callbacks instead of direct dependencies

## [8] Date/Time Handling Issues
--------------------------------------------------
**Problem:** Timezone mismatches, incorrect date comparisons, or serialization errors.

**Solution:**
- Use `LocalDateTime` or `ZonedDateTime` consistently
- Configure timezone in `application.properties`: `spring.jackson.time-zone=UTC`
- Use `@JsonFormat` for custom date formatting in DTOs
- Store dates in UTC, convert to user timezone in API response

**TIP:** Always implement proper exception handling with `@ControllerAdvice` and return meaningful error messages to clients.
