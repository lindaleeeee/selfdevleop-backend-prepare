---
alwaysApply: true
---

/*
Common Error Patterns & Fixes (Spring Boot Backend)
==================================================

[1] LazyInitializationException (JPA)
--------------------------------------------------
- **Cause:** Accessing a lazy-loaded relationship/collection outside of a Transaction.
- **Fix:** 
  1. Ensure the Service method is annotated with `@Transactional`.
  2. Use `@EntityGraph` in the Repository to fetch required relations eagerly for that specific query.
  3. Map to DTO inside the Transactional boundary.

[2] N+1 Select Problem
--------------------------------------------------
- **Cause:** Fetching a list of entities and then accessing a related entity in a loop.
- **Fix:**
  - Use `JOIN FETCH` in JPQL.
  - Use `@EntityGraph`.
  - Validate with query logs (hibernate.show_sql=true).

[3] NullPointerException (DTO Mapping)
--------------------------------------------------
- **Cause:** Mapping null entity fields to DTO primitives or accessing null relations.
- **Fix:**
  - Use `Optional` for return types.
  - Check for nulls in Mapper classes.
  - Use Java 14+ Records (which enforce non-null by design often) or Lombok `@Builder` with validation.

[4] CORS Issues (Backend Side)
--------------------------------------------------
- **Cause:** Frontend (different origin) blocked from accessing API.
- **Fix:**
  - Add `@CrossOrigin(origins = "*")` to Controllers (Dev only).
  - Configure global CORS via `WebMvcConfigurer` bean.

[5] Transaction Rollback Failures
--------------------------------------------------
- **Cause:** Catching exceptions inside a `@Transactional` method without re-throwing.
- **Fix:**
  - Let RuntimeExceptions bubble up to the GlobalExceptionHandler.
  - If catching, explicitly call `TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()`.

--------------------------------------------------
Refer to these patterns to proactively prevent common backend issues!
*/
